# prod-db
_Утилита для управления MAC адресами на производстве_

### В программе использованы библиотеки:

- Разбор параметров командной строки [Taywee/args](https://github.com/Taywee/args)
- Модульные тесты [Catch2](https://github.com/catchorg/Catch2)
- Журнал [spdlog](https://github.com/gabime/spdlog)
- The C++14 wrapper around sqlite library - [sqlite_modern_cpp](https://github.com/SqliteModernCpp/sqlite_modern_cpp)

## Установка

Установка SQLite 3 на Ubuntu
```shell
sudo apt install sqlite3 libsqlite3-dev
```

prod-db
```
git clone https://github.com/ShajTester/prod-db.git
cd prod-db
cmake -DCMAKE_BUILD_TYPE=MinSizeRel .
sudo make install
```

## Использование

Создание нового файла базы данных.
```shell
prod-db --dbfile "test.sqlite" --initdatabase
```
Если файл базы данных не найден и нет ключа `--initdatabase`, то возвращается ошибка.
Если указан ключ `--initdatabase` и файл базы существует, то возвращается ошибка.

Получение адресов, выделенных для изделия с серийным номером "1" или выделение новых адресов:
```shell
prod-db --dbfile "test.sqlite" --product "ver4" --get 1 --ni 0
prod-db --get 1 --ni 0
```
Опция `--ni` указывает номер интерфейса. Для каждого типа устройства определено количество интерфейсов, для которых требуются адреса. Нумерация начинается с 0. Номера интерфейсов соответствуют `rowid`. Т.е. для 0 интерфейса используем адрес с меньшим rowid. Для 1 интерфейса - адрес с большим rowid.

При использовании опции `--ni` выводится только адрес, выделенный для указанного интерфейса, безо всякой дополнительной информации. Если опция `--ni` отсутствует, выводится отчет по всем интерфейсам устройства.

В ключе `--product` можно передавать полное или сокращенное название продукта.
Список известных продуктов можно получить по ключу `--prodlist`.
```shell
prod-db --dbfile "test.sqlite" --prodlist
```

Получение информации по MAC-адресу: для какого серийного номера и когда выдан -
```shell
prod-db --info-mac "00-1d-c3-00-00-ab"
```

Освобождение адресов, присвоенных устройству c серийным номером "1":
```shell
prod-db --dbfile "test.sqlite" --free 1
prod-db --free 1
```

Вместо `--dbfile "test.sqlite"`, можно указывать путь к файлу конфигурации `--conf "~/my path/prod-db.conf"`

### Пример скрипта на память

```shell
#!/bin/bush

var1=$(echo "001234")
var2=$(echo ":090807aa")

echo $var1$var2"\n"
```

## Файл конфигурации

В файле конфигурации записан путь к базе данных (строка подключения) и текущий тип изделия. Если в параметрах не указано другое, используются эти значения.

Программа ищет файл конфигурации по следующим путям:
1. `~/.config/prod-db/prod-db.conf`
1. `/etc/pord-db/prod-db.conf`
1. `./prod-db.conf`

Если в ключах не указаны путь к БД и тип изделия, и файл конфигурации не найден, то выдается сообщение об ошибке.

Файл конфигурации обновляется при каждом успешнов выполнении программы. Если был прочитан файл из `/etc/pord-db/prod-db.conf`, а сохранить туда не удается, то конфигурация сохраняется в `~/.config/prod-db/prod-db.conf`, и следующий раз читается из `~/.config/prod-db/prod-db.conf`.




